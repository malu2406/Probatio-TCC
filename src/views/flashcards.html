<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/css/flashcards.css" />
    <title>Flashcards - PROBATIO</title>
  </head>
  <body>
    <div id="container">
      <header>
        <div id="header_esquerda">
          <a href="/inicio" id="logo">PROBATIO</a>
          <a href="/material">Matérias</a>
          <a href="/simulado_teste">Simulados</a>
          <a href="/teste_es">Estatísticas</a>
          <a href="/flashcards">Flashcards</a>
          <a href="/noticias">Portal de Noticias</a>
          <a href="/pomodoro">Pomodoro</a>
          <a href="/perfil"
            ><img src="/img/user.png" alt="Perfil" class="icon"
          /></a>
          <a href="/logout">Sair</a>
        </div>
      </header>

      <main>
        <h1>Flashcards</h1>

        <div class="filtros">
          <button class="filtro-btn ativo" data-materia="todas">Todas</button>
          <button class="filtro-btn" data-materia="matematica">
            Matemática
          </button>
          <button class="filtro-btn" data-materia="linguagens">
            Linguagens
          </button>
          <button class="filtro-btn" data-materia="humanas">
            Ciências Humanas
          </button>
          <button class="filtro-btn" data-materia="natureza">
            Ciências da Natureza
          </button>
        </div>

        <div class="flashcard-container" id="flashcardsContainer">
          <!-- Flashcards serão carregados dinamicamente via JavaScript -->
        </div>
        <div class="estatisticas">
          <h2>Seu Desempenho</h2>
          <div class="stats-grid">
            <div class="stat-card">
              <h3>Matemática</h3>
              <p id="stat-matematica">0/0</p>
            </div>
            <div class="stat-card">
              <h3>Linguagens</h3>
              <p id="stat-linguagens">0/0</p>
            </div>
            <div class="stat-card">
              <h3>Ciências Humanas</h3>
              <p id="stat-humanas">0/0</p>
            </div>
            <div class="stat-card">
              <h3>Ciências da Natureza</h3>
              <p id="stat-natureza">0/0</p>
            </div>
          </div>
        </div>
      </main>

      <div class="linha">
        <hr />
      </div>

      <footer>
        <div class="logofinal">
          <a href="#inicio" id="logo">PROBATIO</a>
        </div>
      </footer>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Carregar flashcards do banco de dados
        loadFlashcardsFromDB();

        // ... o resto do seu código JavaScript existente (filtros, estatísticas, etc.)

        async function loadFlashcardsFromDB() {
          try {
            const response = await fetch("/api/todos-flashcards");
            const flashcards = await response.json();

            const container = document.getElementById("flashcardsContainer");
            container.innerHTML = "";

            if (flashcards.length === 0) {
              container.innerHTML =
                '<div class="no-flashcards">Nenhum flashcard disponível no momento.</div>';
              return;
            }

            flashcards.forEach((flashcard) => {
              const flashcardElement = createFlashcardElement(flashcard);
              container.appendChild(flashcardElement);
            });

            // Re-aplicar os event listeners após carregar os flashcards
            reapplyEventListeners();
          } catch (error) {
            console.error("Erro ao carregar flashcards:", error);
            document.getElementById("flashcardsContainer").innerHTML =
              '<div class="error-message">Erro ao carregar flashcards.</div>';
          }
        }

        function createFlashcardElement(flashcard) {
          const div = document.createElement("div");
          div.className = "flashcard";

          // Mapear a matéria para o formato usado no CSS
          const materiaMap = {
            CH: "humanas",
            CN: "natureza",
            LINGUAGENS: "linguagens",
            MATEMATICA: "matematica",
          };

          const materiaClass = materiaMap[flashcard.materia] || "humanas";
          const materiaNames = {
            CH: "Ciências Humanas",
            CN: "Ciências da Natureza",
            LINGUAGENS: "Linguagens",
            MATEMATICA: "Matemática",
          };

          div.setAttribute("data-materia", materiaClass);
          div.innerHTML = `
        <span class="materia-tag ${materiaClass}">${
            materiaNames[flashcard.materia] || flashcard.materia
          }</span>
        <div class="conteudo-tag">${flashcard.conteudo}</div>
        <div class="pergunta">${flashcard.pergunta}</div>
        <div class="resposta">${flashcard.resposta}</div>
        <div class="controles">
          <button class="btn mostrar-resposta">Mostrar Resposta</button>
          <div class="feedback-buttons" style="display: none">
            <button class="btn acertou">Acertou</button>
            <button class="btn errou">Errou</button>
          </div>
        </div>
      `;

          return div;
        }

        function reapplyEventListeners() {
          // Mostrar/ocultar respostas
          const mostrarRespostaButtons =
            document.querySelectorAll(".mostrar-resposta");
          mostrarRespostaButtons.forEach((button) => {
            button.addEventListener("click", (e) => {
              const card = e.target.closest(".flashcard");
              const resposta = card.querySelector(".resposta");
              const feedbackButtons = card.querySelector(".feedback-buttons");

              resposta.style.display = "block";
              feedbackButtons.style.display = "flex";
              button.style.display = "none";
            });
          });

          // Botões de acerto/erro
          const acertouButtons = document.querySelectorAll(".acertou");
          const errouButtons = document.querySelectorAll(".errou");

          acertouButtons.forEach((button) => {
            button.addEventListener("click", (e) => {
              const card = e.target.closest(".flashcard");
              const materia = card.getAttribute("data-materia");
              registerAnswer(materia, true);
              card.style.display = "none";
            });
          });

          errouButtons.forEach((button) => {
            button.addEventListener("click", (e) => {
              const card = e.target.closest(".flashcard");
              const materia = card.getAttribute("data-materia");
              registerAnswer(materia, false);
              card.style.display = "none";
            });
          });
        }

        // Função para registrar resposta (mantenha a existente)
        function registerAnswer(materia, acertou) {
          let stats = JSON.parse(localStorage.getItem("flashcardStats")) || {
            matematica: { total: 0, acertos: 0 },
            linguagens: { total: 0, acertos: 0 },
            humanas: { total: 0, acertos: 0 },
            natureza: { total: 0, acertos: 0 },
          };

          stats[materia].total += 1;
          if (acertou) {
            stats[materia].acertos += 1;
          }

          localStorage.setItem("flashcardStats", JSON.stringify(stats));
          updateStatsDisplay();
        }

        // Funções de estatísticas (mantenha as existentes)
        function loadStats() {
          // ... seu código existente
        }

        function updateStatsDisplay() {
          // ... seu código existente
        }
      });
    </script>
  </body>
</html>
